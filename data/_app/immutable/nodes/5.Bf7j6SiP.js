import{f as m,a as p,c as St}from"../chunks/CJzwpuKh.js";import{o as Ft}from"../chunks/tgyn-xxr.js";import{p as Ct,s as w,a as Z,e as v,b as Nt,c as s,d as l,r as i,g as e,t as k,f as C}from"../chunks/fsS-m6VO.js";import{d as jt,s as D}from"../chunks/jRq-jFgM.js";import{i as P}from"../chunks/DGklRumq.js";import{e as $,i as tt}from"../chunks/BzWd8bhm.js";import{r as Et}from"../chunks/CcDg8Ibl.js";import{s as Vt}from"../chunks/DOhhwrM8.js";import{b as Tt}from"../chunks/DQHpviRV.js";import{i as Ot,s as At}from"../chunks/DnVtuXwL.js";var Ut=m('<div role="status" aria-live="polite"><span> </span> <button class="btn btn-ghost btn-xs" aria-label="Dismiss message">âœ•</button></div>'),It=m('<div class="flex justify-center p-8"><span class="loading loading-spinner loading-lg"></span></div>'),Mt=m('<div class="card bg-base-200"><div class="card-body text-center"><div class="text-4xl mb-2">ğŸ“­</div> <p class="text-base-content/60">No saved V1 devices yet</p> <p class="text-sm text-base-content/40">Connect to a V1 and it will be saved automatically</p></div></div>'),Rt=m('<input type="text" class="input input-bordered input-sm w-full max-w-48" placeholder="Enter a name..."/>'),Wt=m('<h3 class="font-bold"> </h3>'),qt=m('<button class="btn btn-success btn-sm">ğŸ’¾</button> <button class="btn btn-ghost btn-sm">âœ•</button>',1),zt=m('<button class="btn btn-ghost btn-sm" title="Edit name">âœï¸</button> <button class="btn btn-ghost btn-sm text-error" title="Delete">ğŸ—‘ï¸</button>',1),Bt=m("<option> </option>"),Gt=m('<p class="text-xs text-base-content/50 mt-1"> </p>'),Ht=m('<div class="card bg-base-200"><div class="card-body p-4"><div class="flex justify-between items-start gap-2"><div class="flex items-center gap-3 flex-1"><div class="text-3xl">ğŸ“¡</div> <div class="flex-1"><!> <div class="text-xs font-mono text-base-content/50"> </div></div></div> <div class="flex gap-1"><!></div></div> <div class="mt-3 pt-3 border-t border-base-300"><div class="flex items-center gap-2"><span class="text-sm text-base-content/70">ğŸš— Default Profile:</span> <select class="select select-bordered select-sm flex-1 max-w-xs"><option>None (manual)</option><!></select></div> <!></div></div></div>'),Jt=m('<div class="space-y-3"></div> <div class="text-xs text-base-content/40 text-center"> </div>',1),Kt=m('<div class="space-y-6"><div class="flex justify-between items-center"><div><h1 class="text-2xl font-bold">Saved V1 Devices</h1> <p class="text-sm text-base-content/60">Fast reconnect & auto-push profiles</p></div> <button class="btn btn-sm btn-outline">ğŸ”„ Refresh</button></div> <!> <div class="text-sm text-base-content/60 bg-base-200 p-3 rounded-lg"><p>ğŸ“¡ Saved V1 devices for fast reconnect. Set a default auto-push profile for each device - perfect for different vehicles!</p></div> <!></div>');function re(et,at){Ct(at,!0);let _=w(Z([])),M=w(Z([])),N=w(!0),c=w(null),S=w(null),h=w("");Ft(async()=>{await Promise.all([R(),st()])});async function R(){s(N,!0);try{const t=await fetch("/api/v1/devices");if(t.ok){const a=await t.json();s(_,a.devices||[],!0)}else s(c,{type:"error",text:"Failed to load devices"},!0)}catch{s(c,{type:"error",text:"Connection error"},!0)}finally{s(N,!1)}}async function st(){try{const t=await fetch("/api/autopush/slots");if(t.ok){const a=await t.json();s(M,a.slots||[],!0)}}catch{}}function W(t){if(t===0)return"None (manual)";const a=e(M)[t-1];return(a==null?void 0:a.name)||`Slot ${t}`}function rt(t){s(S,t.address,!0),s(h,t.name||"",!0)}function ot(){s(S,null),s(h,"")}async function q(t){try{const a=new FormData;if(a.append("address",t),a.append("name",e(h)),(await fetch("/api/v1/devices/name",{method:"POST",body:a})).ok){const u=e(_).find(x=>x.address===t);u&&(u.name=e(h)),s(c,{type:"success",text:"Name saved!"},!0),s(S,null),s(h,"")}else s(c,{type:"error",text:"Failed to save"},!0)}catch{s(c,{type:"error",text:"Connection error"},!0)}}async function nt(t,a){try{const f=new FormData;if(f.append("address",t),f.append("profile",a),(await fetch("/api/v1/devices/profile",{method:"POST",body:f})).ok){const x=e(_).find(b=>b.address===t);x&&(x.defaultProfile=parseInt(a)),s(c,{type:"success",text:"Default profile saved!"},!0)}else s(c,{type:"error",text:"Failed to save profile"},!0)}catch{s(c,{type:"error",text:"Connection error"},!0)}}async function it(t){const a=e(_).find(u=>u.address===t),f=(a==null?void 0:a.name)||t;if(confirm(`Delete "${f}" from fast reconnect cache?

This will remove the device from automatic reconnection.`))try{const u=new FormData;u.append("address",t),(await fetch("/api/v1/devices/delete",{method:"POST",body:u})).ok?(s(_,e(_).filter(b=>b.address!==t),!0),s(c,{type:"success",text:"Device removed"},!0)):s(c,{type:"error",text:"Failed to delete"},!0)}catch{s(c,{type:"error",text:"Connection error"},!0)}}function lt(t){return t.toUpperCase()}var j=Kt(),E=l(j),ct=v(l(E),2);ct.__click=R,i(E);var z=v(E,2);{var dt=t=>{var a=Ut(),f=l(a),u=l(f,!0);i(f);var x=v(f,2);x.__click=()=>s(c,null),i(a),k(()=>{Vt(a,1,`alert alert-${e(c).type==="error"?"error":e(c).type==="success"?"success":"info"}`),D(u,e(c).text)}),p(t,a)};P(z,t=>{e(c)&&t(dt)})}var vt=v(z,4);{var ft=t=>{var a=It();p(t,a)},ut=t=>{var a=St(),f=C(a);{var u=b=>{var F=Mt();p(b,F)},x=b=>{var F=Jt(),V=C(F);$(V,21,()=>e(_),tt,(mt,d)=>{var T=Ht(),G=l(T),O=l(G),A=l(O),H=v(l(A),2),J=l(H);{var _t=r=>{var o=Rt();Et(o),o.__keydown=n=>n.key==="Enter"&&q(e(d).address),Tt(o,()=>e(h),n=>s(h,n)),p(r,o)},bt=r=>{var o=Wt(),n=l(o,!0);i(o),k(()=>D(n,e(d).name||"Unnamed V1")),p(r,o)};P(J,r=>{e(S)===e(d).address?r(_t):r(bt,!1)})}var K=v(J,2),xt=l(K,!0);i(K),i(H),i(A);var L=v(A,2),ht=l(L);{var yt=r=>{var o=qt(),n=C(o);n.__click=()=>q(e(d).address);var g=v(n,2);g.__click=ot,p(r,o)},gt=r=>{var o=zt(),n=C(o);n.__click=()=>rt(e(d));var g=v(n,2);g.__click=()=>it(e(d).address),p(r,o)};P(ht,r=>{e(S)===e(d).address?r(yt):r(gt,!1)})}i(L),i(O);var Q=v(O,2),U=l(Q),y=v(l(U),2);y.__change=r=>nt(e(d).address,r.target.value);var I=l(y);I.value=I.__value="0";var wt=v(I);$(wt,16,()=>[1,2,3],tt,(r,o)=>{var n=Bt(),g=l(n,!0);i(n);var Y={};k(Pt=>{D(g,Pt),Y!==(Y=o)&&(n.value=(n.__value=o)??"")},[()=>W(o)]),p(r,n)}),i(y);var X;Ot(y),i(U);var kt=v(U,2);{var Dt=r=>{var o=Gt(),n=l(o);i(o),k(g=>D(n,`Will auto-push "${g??""}" on connect`),[()=>W(e(d).defaultProfile)]),p(r,o)};P(kt,r=>{e(d).defaultProfile>0&&r(Dt)})}i(Q),i(G),i(T),k(r=>{D(xt,r),X!==(X=e(d).defaultProfile||0)&&(y.value=(y.__value=e(d).defaultProfile||0)??"",At(y,e(d).defaultProfile||0))},[()=>lt(e(d).address)]),p(mt,T)}),i(V);var B=v(V,2),pt=l(B);i(B),k(()=>D(pt,`${e(_).length??""} device${e(_).length===1?"":"s"} saved`)),p(b,F)};P(f,b=>{e(_).length===0?b(u):b(x,!1)},!0)}p(t,a)};P(vt,t=>{e(N)?t(ft):t(ut,!1)})}i(j),p(et,j),Nt()}jt(["click","keydown","change"]);export{re as component};
