import{f,a as v,b as ae}from"../chunks/BAToY3dM.js";import{o as Ce}from"../chunks/tgyn-xxr.js";import{p as Me,b as Se,e as n,d as o,g as t,s as i,r,c as e,t as G,f as Be,n as m}from"../chunks/fsS-m6VO.js";import{d as Ee,s as _}from"../chunks/DKvjqhBm.js";import{i as x}from"../chunks/DGklRumq.js";import{r as te,a as ze}from"../chunks/DtA2OqT-.js";import{s as N}from"../chunks/DOhhwrM8.js";import{a as Fe}from"../chunks/DQHpviRV.js";var Te=f('<div role="status" aria-live="polite"> </div>'),De=f('<div class="flex justify-center py-12"><span class="loading loading-spinner loading-lg text-cyan-400"></span></div>'),Ve=f('<span class="loading loading-spinner loading-sm"></span>'),Ae=ae('<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>'),He=f('<span class="loading loading-spinner loading-sm"></span>'),Re=ae('<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>'),Ge=f('<div class="card bg-base-200"><div class="card-body p-4"><div class="flex justify-between items-center mb-2"><h2 class="card-title text-lg">Log Viewer (last 32KB)</h2> <div class="flex items-center gap-4"><label class="cursor-pointer flex items-center gap-2 text-sm"><input type="checkbox" class="checkbox checkbox-sm"/> Auto-scroll</label> <button class="btn btn-ghost btn-sm"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> Refresh</button> <button class="btn btn-ghost btn-sm" aria-label="Close log viewer"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button></div></div> <pre id="log-viewer" class="bg-base-300 rounded-lg p-4 text-xs font-mono overflow-auto max-h-96 whitespace-pre-wrap break-all"> </pre></div></div>'),Ne=f(`<div class="card bg-base-200"><div class="card-body"><h2 class="card-title text-lg">Status</h2> <div class="divide-y divide-base-300"><div class="flex justify-between items-center py-3"><span class="text-base-content/60">SD Card</span> <span> </span></div> <div class="flex justify-between items-center py-3"><span class="text-base-content/60">Logging</span> <label class="cursor-pointer flex items-center gap-2"><input type="checkbox" class="toggle toggle-success toggle-sm"/> <span> </span></label></div> <div class="flex justify-between items-center py-3"><span class="text-base-content/60">Log Size</span> <span class="font-mono"> </span></div> <div class="flex justify-between items-center py-3"><span class="text-base-content/60">Max Size</span> <span class="font-mono">2 GB</span></div></div></div></div> <div class="flex flex-wrap gap-3 justify-center"><button class="btn btn-secondary"><!> View Log</button> <button class="btn btn-primary"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg> Download</button> <button class="btn btn-error"><!> Clear</button></div> <!> <div class="alert bg-base-300"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-info" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <div><span class="font-semibold">Note:</span> Serial log captures all debug output (what you'd see in <code class="text-cyan-400">pio device monitor</code>). 
        Useful for debugging issues in the field. Log rotates automatically at 2GB.</div></div>`,1),Oe=f('<div class="space-y-6"><h1 class="text-2xl font-bold text-cyan-400">System Logs</h1> <p class="text-base-content/60">Debug output saved to SD card</p> <!> <!></div>');function Xe(se,oe){Me(oe,!0);let g=i(!1),p=i(!1),O=i("0 B"),L=i(!0),y=i(!1),C=i(!1),d=i(""),u=i(""),M=i(""),k=i(!1),S=i(!1),B=i(!0);async function P(){e(L,!0);try{const a=await fetch("/api/seriallog");if(!a.ok)throw new Error("Failed to load");const s=await a.json();e(g,s.sdReady||!1,!0),e(p,s.logEnabled||!1,!0),e(O,s.logSize||"0 B",!0)}catch{e(d,"Failed to load status"),e(u,"error")}finally{e(L,!1)}}async function re(){e(C,!0),e(d,"");try{const s=await(await fetch(`/api/seriallog/toggle?enable=${!t(p)}`,{method:"POST"})).json();if(s.success)e(p,s.enabled,!0),e(d,t(p)?"Logging enabled":"Logging disabled",!0),e(u,"success");else throw new Error("Toggle failed")}catch{e(d,"Failed to toggle logging"),e(u,"error")}finally{e(C,!1)}}async function I(){e(k,!0);try{const a=await fetch("/api/seriallog/content?tail=32768");if(!a.ok)throw new Error("Failed to load");e(M,await a.text(),!0),e(S,!0),setTimeout(()=>{if(t(B)){const s=document.getElementById("log-viewer");s&&(s.scrollTop=s.scrollHeight)}},50)}catch{e(d,"Failed to load log content"),e(u,"error")}finally{e(k,!1)}}async function le(){if(confirm("Clear the system log? This cannot be undone.")){e(y,!0),e(d,"");try{if((await(await fetch("/api/seriallog/clear",{method:"POST"})).json()).success)e(d,"Log cleared!"),e(u,"success"),e(M,""),await P();else throw new Error("Failed to clear")}catch{e(d,"Failed to clear log"),e(u,"error")}finally{e(y,!1)}}}function ne(){window.location.href="/serial_log.txt"}Ce(()=>{P()});var E=Oe(),K=n(o(E),4);{var ie=a=>{var s=Te(),b=o(s,!0);r(s),G(()=>{N(s,1,`alert ${t(u)==="success"?"alert-success":"alert-error"}`),_(b,t(d))}),v(a,s)};x(K,a=>{t(d)&&a(ie)})}var ce=n(K,2);{var de=a=>{var s=De();v(a,s)},ve=a=>{var s=Ne(),b=Be(s),U=o(b),q=n(o(U),2),z=o(q),F=n(o(z),2),ge=o(F,!0);r(F),r(z);var T=n(z,2),J=n(o(T),2),h=o(J);te(h),h.__change=re;var D=n(h,2),pe=o(D,!0);r(D),r(J),r(T);var Q=n(T,2),W=n(o(Q),2),ue=o(W,!0);r(W),r(Q),m(2),r(q),r(U),r(b);var V=n(b,2),w=o(V);w.__click=I;var fe=o(w);{var be=l=>{var c=Ve();v(l,c)},he=l=>{var c=Ae();v(l,c)};x(fe,l=>{t(k)?l(be):l(he,!1)})}m(),r(w);var A=n(w,2);A.__click=ne;var j=n(A,2);j.__click=le;var we=o(j);{var me=l=>{var c=He();v(l,c)},_e=l=>{var c=Re();v(l,c)};x(we,l=>{t(y)?l(me):l(_e,!1)})}m(),r(j),r(V);var xe=n(V,2);{var ye=l=>{var c=Ge(),X=o(c),H=o(X),Y=n(o(H),2),R=o(Y),Z=o(R);te(Z),m(),r(R);var $=n(R,2);$.__click=I;var ke=n($,2);ke.__click=()=>e(S,!1),r(Y),r(H);var ee=n(H,2),je=o(ee,!0);r(ee),r(X),r(c),G(()=>_(je,t(M)||"Log is empty")),Fe(Z,()=>t(B),Le=>e(B,Le)),v(l,c)};x(xe,l=>{t(S)&&l(ye)})}m(2),G(()=>{N(F,1,`badge ${t(g)?"badge-success":"badge-error"}`),_(ge,t(g)?"Mounted":"Not Available"),ze(h,t(p)),h.disabled=!t(g)||t(C),N(D,1,`badge ${t(p)?"badge-success":"badge-warning"}`),_(pe,t(p)?"Enabled":"Disabled"),_(ue,t(O)),w.disabled=!t(g)||t(k),A.disabled=!t(g),j.disabled=!t(g)||t(y)}),v(a,s)};x(ce,a=>{t(L)?a(de):a(ve,!1)})}r(E),v(se,E),Se()}Ee(["change","click"]);export{Xe as component};
