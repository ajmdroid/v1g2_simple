; PlatformIO Project Configuration for V1 Gen2 Simple Display
; Waveshare ESP32-S3-Touch-LCD-3.49 only
; ========================================
; AXS15231B 640x172 QSPI display
; ========================================
[env:waveshare-349]
platform = https://github.com/pioarduino/platform-espressif32/releases/download/53.03.11/platform-espressif32.zip
board = esp32-s3-devkitc-1
framework = arduino

; Upload settings
upload_speed = 921600
monitor_speed = 115200

; Build flags
build_flags = 
    -D ARDUINO_USB_CDC_ON_BOOT=1
    -D BOARD_HAS_PSRAM
    ; Performance metrics (1=enabled with sampled latency tracking)
    -D PERF_METRICS=1
    -D PERF_MONITORING=1
    ; Waveshare board identifier
    -D DISPLAY_WAVESHARE_349=1
    ; Screen dimensions (rotated landscape)
    -D SCREEN_WIDTH=640
    -D SCREEN_HEIGHT=172
    ; QSPI Display pins
    -D LCD_CS=9
    -D LCD_SCLK=10
    -D LCD_DATA0=11
    -D LCD_DATA1=12
    -D LCD_DATA2=13
    -D LCD_DATA3=14
    -D LCD_RST=21
    -D LCD_BL=8
    ; Use Arduino_GFX for AXS15231B
    -D USE_ARDUINO_GFX=1

; Required libraries - pinned versions for reproducible builds
; NOTE: Sqlite3Esp32 removed - alert logging has been fully removed
lib_deps = 
    moononournation/GFX Library for Arduino@1.6.4
    h2zero/NimBLE-Arduino@2.3.7
    bblanchon/ArduinoJson@7.4.2
    https://github.com/takkaO/OpenFontRender.git
    adafruit/Adafruit GPS Library@1.7.5
    mikalhart/TinyGPSPlus@1.0.3

; Board configuration - 16MB flash, 8MB PSRAM
board_build.partitions = default_16MB.csv
board_build.flash_mode = qio
board_build.flash_size = 16MB
board_build.f_flash = 80000000L
board_build.f_cpu = 240000000L
board_build.arduino.memory_type = qio_opi

; Filesystem configuration (for web UI files)
board_build.filesystem = littlefs

; ========================================
; Windows-specific environment
; Uses same pioarduino platform but with Windows-compatible settings
; Use this on Windows: pio run -e waveshare-349-windows
; ========================================
[env:waveshare-349-windows]
platform = https://github.com/pioarduino/platform-espressif32/releases/download/53.03.11/platform-espressif32.zip
board = esp32-s3-devkitc-1
framework = arduino

; Upload settings
upload_speed = 921600
monitor_speed = 115200

; Build flags - same as main env
build_flags = 
    -D ARDUINO_USB_CDC_ON_BOOT=1
    -D BOARD_HAS_PSRAM
    ; Performance metrics (1=enabled with sampled latency tracking)
    -D PERF_METRICS=1
    -D PERF_MONITORING=1
    -D DISPLAY_WAVESHARE_349=1
    -D SCREEN_WIDTH=640
    -D SCREEN_HEIGHT=172
    -D LCD_CS=9
    -D LCD_SCLK=10
    -D LCD_DATA0=11
    -D LCD_DATA1=12
    -D LCD_DATA2=13
    -D LCD_DATA3=14
    -D LCD_RST=21
    -D LCD_BL=8
    -D USE_ARDUINO_GFX=1

; Same libraries as main env
lib_deps = 
    moononournation/GFX Library for Arduino@1.6.4
    h2zero/NimBLE-Arduino@2.3.7
    bblanchon/ArduinoJson@7.4.2
    https://github.com/takkaO/OpenFontRender.git
    adafruit/Adafruit GPS Library@1.7.5
    mikalhart/TinyGPSPlus@1.0.3

; Board configuration - 16MB flash, 8MB PSRAM
board_build.partitions = default_16MB.csv
board_build.flash_mode = qio
board_build.flash_size = 16MB
board_build.f_flash = 80000000L
board_build.f_cpu = 240000000L
board_build.arduino.memory_type = qio_opi

; Filesystem configuration (for web UI files)
board_build.filesystem = littlefs


; ========================================
; Native test environment (runs on host machine)
; For unit testing without hardware
; Use: pio test -e native
; ========================================
[env:native]
platform = native
build_flags = 
    -D UNIT_TEST
    -std=c++17
    -I test/mocks
test_framework = unity
test_build_src = false
